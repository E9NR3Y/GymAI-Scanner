- name: Install Dependencies
        run: npm install

      - name: Build Web Assets (Compilazione React)
        run: |
          npm run build
          # Vite di solito crea una cartella 'dist'. Capacitor vuole 'www'.
          # Se 'dist' esiste, la rinominiamo in 'www'.
          if [ -d "dist" ]; then
            rm -rf www
            mv dist www
          fi

      - name: Emergency Capacitor Reset
        run: |
          rm -rf android
          echo '{"appId":"com.gymai.scanner","appName":"GymAI Scanner","webDir":"www","bundledWebRuntime":false}' > capacitor.config.json

      - name: Initialize Android
        run: |
          npx cap add android
          npx cap copy android
          npx cap sync android
